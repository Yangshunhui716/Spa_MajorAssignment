{% extends 'admin/master.html' %}
{% block body %}

<div class="container-fluid">

    <h3 class="mb-4">üìä B√ÅO C√ÅO TH·ªêNG K√ä (PHI·∫æU D·ªäCH V·ª§)</h3>

    <!-- ================= DOANH THU ================= -->
    <div class="card mb-4">
        <div class="card-header bg-dark text-white">
            1Ô∏è‚É£ Doanh thu theo th√°ng
        </div>
        <div class="card-body">
            <div class="row">
                <!-- TABLE -->
                <div class="col-md-5">
                    <table class="table table-bordered table-striped">
                        <thead class="table-light">
                        <tr>
                            <th>Th√°ng</th>
                            <th class="text-end">Doanh thu</th>
                        </tr>
                        </thead>
                        <tbody>
                        {% for thang, doanh_thu in doanh_thu_thang %}
                        <tr>
                            <td>{{ thang }}</td>
                            <td class="text-end">
                                {{ "{:,.0f}".format(doanh_thu or 0) }} ƒë
                            </td>
                        </tr>
                        {% endfor %}
                        </tbody>
                    </table>
                </div>

                <!-- CHART -->
                <div class="col-md-7">
                    <canvas id="doanhThuChart" height="200"></canvas>
                </div>
            </div>
        </div>
    </div>

    <!-- ================= T·∫¶N SU·∫§T ================= -->
    <div class="card">
        <div class="card-header bg-dark text-white">
            2Ô∏è‚É£ T·∫ßn su·∫•t s·ª≠ d·ª•ng d·ªãch v·ª•
        </div>
        <div class="card-body">

            <!-- TABLE -->
            <table class="table table-bordered table-hover mb-4">
                <thead class="table-light">
                <tr>
                    <th>Th√°ng</th>
                    <th>D·ªãch v·ª•</th>
                    <th class="text-center">S·ªë l·∫ßn</th>
                </tr>
                </thead>
                <tbody>
                {% for thang, ten_dv, so_lan in tan_suat_dich_vu %}
                <tr>
                    <td>{{ thang }}</td>
                    <td>{{ ten_dv }}</td>
                    <td class="text-center">{{ so_lan }}</td>
                </tr>
                {% endfor %}
                </tbody>
            </table>

            <!-- CHART GRID -->
            <div class="row">
                {% for thang, dv in tan_suat_chart.items() %}
                <div class="col-md-4 mb-4">
                    <div class="border rounded p-3 h-100">
                        <h6 class="text-center fw-bold mb-3">{{ thang }}</h6>
                        <canvas id="chart_{{ loop.index }}" height="200"></canvas>
                    </div>
                </div>
                {% endfor %}
            </div>

        </div>
    </div>

</div>

<!-- ================= SCRIPT ================= -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>
    // ===== DOANH THU =====
    const doanhThu = {{ doanh_thu_chart | tojson }};
    new Chart(document.getElementById('doanhThuChart'), {
        type: 'bar',
        data: {
            labels: doanhThu.labels,
            datasets: [{
                label: 'Doanh thu (VNƒê)',
                data: doanhThu.data,
                backgroundColor: '#0d6efd'
            }]
        },
        options: {
            responsive: true,
            plugins: {
                legend: { display: false }
            }
        }
    });

    // ===== T·∫¶N SU·∫§T =====
    const tanSuat = {{ tan_suat_chart | tojson }};
    let i = 1;

    for (const [thang, dv] of Object.entries(tanSuat)) {
        new Chart(document.getElementById('chart_' + i), {
            type: 'pie',
            data: {
                labels: Object.keys(dv),
                datasets: [{
                    data: Object.values(dv)
                }]
            },
            options: {
                responsive: true,
                plugins: {
                    legend: {
                        position: 'bottom'
                    }
                }
            }
        });
        i++;
    }
</script>

{% endblock %}
